<!DOCTYPE html>
<html lang="id">
  <head>
    <link rel="icon" type="image/png" href="assets/icons/ico.png" />
    <link rel="manifest" href="manifest.json" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="NOC Report" />
    <link rel="apple-touch-icon" href="assets/icons/ico.png" />
    <meta name="theme-color" content="#4f46e5" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Input Laporan Harian - Staf Report App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      .content-area {
        transition: margin-left 0.3s ease-in-out;
        min-height: 100vh;
      }
      @media (min-width: 768px) {
        .content-area {
          margin-left: 16rem;
        }
      }
      input:disabled,
      select:disabled {
        background-color: #f3f4f6;
        cursor: not-allowed;
      }
      /* Menjaga input tetap putih saat diisi atau autofill */
      input:not([type="checkbox"]):not([type="radio"]),
      select,
      textarea {
        background-color: #ffffff !important;
        color: #1f2937 !important; /* Warna teks abu gelap agar terbaca jelas */
      }

      /* Khusus untuk menangani warna kuning/abu dari fitur autofill browser Chrome/Edge */
      input:-webkit-autofill,
      input:-webkit-autofill:hover,
      input:-webkit-autofill:focus,
      input:-webkit-autofill:active {
        -webkit-box-shadow: 0 0 0 30px white inset !important;
        -webkit-text-fill-color: #1f2937 !important;
      }

      /* Memastikan saat fokus (diklik) background tidak berubah abu */
      input:focus,
      select:focus {
        background-color: #ffffff !important;
        outline: none;
        border-color: #4f46e5 !important; /* Warna indigo saat fokus agar cantik */
        box-shadow: 0 0 0 2px rgba(79, 70, 229, 0.1);
      }

      @keyframes pulse-green {
        0% {
          transform: scale(0.95);
          box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
        }
        70% {
          transform: scale(1);
          box-shadow: 0 0 0 20px rgba(34, 197, 94, 0);
        }
        100% {
          transform: scale(0.95);
          box-shadow: 0 0 0 0 rgba(34, 197, 94, 0);
        }
      }

      /* Class ini akan memicu animasi berdenyut dan memberikan border putih tipis */
      .animate-chat-welcome {
        animation: pulse-green 2s infinite;
        border: 2px solid white !important;
      }

      .chat-text-format {
        white-space: pre-line; /* Menjaga baris baru (enter) */
        word-break: break-word; /* Mencegah teks keluar batas */
        line-height: 1.5; /* Agar lebih enak dibaca jika banyak baris */
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <div
      id="backdrop"
      class="fixed inset-0 bg-black opacity-0 z-30 transition-opacity duration-300 md:hidden pointer-events-none"
    ></div>

    <nav
      class="bg-indigo-800 text-white w-64 space-y-6 py-7 px-2 fixed inset-y-0 left-0 transform -translate-x-full md:translate-x-0 transition duration-300 ease-in-out z-40 shadow-2xl"
      id="sidebar"
    >
      <a
        href="index.html"
        class="text-white flex items-center space-x-3 px-4 mb-8 border-b border-indigo-700 pb-4"
      >
        <svg
          class="w-7 h-7 text-indigo-300"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path d="M12 2L2 7V17L12 22L22 17V7L12 2Z" fill="currentColor"></path>
        </svg>
        <span class="text-2xl font-extrabold tracking-wider">Reporting</span>
      </a>
      <div class="px-4">
        <a
          href="index.html"
          class="flex items-center space-x-3 py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-150 mt-1 text-indigo-100"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"
            ></path>
          </svg>
          <span>Dashboard</span>
        </a>
        <a
          href="input_tiket.html"
          class="flex items-center space-x-3 py-2 px-4 rounded-lg bg-indigo-700 transition duration-150 shadow-md font-semibold"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
            ></path>
          </svg>
          <span>Input Laporan</span>
        </a>
        <a
          href="jadwal.html"
          class="flex items-center space-x-3 py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-150 mt-1 text-indigo-100"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
              clip-rule="evenodd"
            ></path>
          </svg>
          <span>Jadwal Staf</span>
        </a>
        <a
          href="kelola_staf.html"
          class="admin-only flex items-center space-x-3 py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-150 mt-1 text-indigo-100"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20v-2c0-.214-.029-.426-.08-.632M20 10V8a2 2 0 00-2-2h-2m2 2h2m-2-2h-2m2 0v-2a2 2 0 00-2-2H4a2 2 0 00-2 2v10a2 2 0 002 2h2m-2-2h2m-2 0v-2a2 2 0 002-2h2m-2 2h2m-2 2h2m2-10a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
            ></path>
          </svg>
          <span>Kelola Staf</span>
        </a>
        <a
          href="javascript:void(0)"
          onclick="cekAksesKelolaIP()"
          class="flex items-center space-x-3 py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-150 mt-1 text-indigo-100"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
            ></path>
          </svg>
          <span>Kelola IP</span>
        </a>
      </div>
    </nav>

    <div class="content-area">
      <header class="sticky top-0 bg-white shadow-md p-4 mb-4 md:mb-8 z-30">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <button
              class="p-2 rounded-md hover:bg-gray-100 transition md:hidden"
              id="menu-toggle"
            >
              <svg
                class="w-6 h-6 text-indigo-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16m-7 6h7"
                ></path>
              </svg>
            </button>
            <h1
              class="text-xl md:text-2xl font-extrabold text-gray-800"
              id="page-title"
            >
              Input Laporan Harian
            </h1>
          </div>
          <div
            class="flex items-center space-x-3 border-l pl-4 border-gray-100"
          >
            <div class="text-right hidden sm:block">
              <p
                id="user-display-name"
                class="text-sm font-bold text-gray-800 leading-none capitalize"
              >
                Loading...
              </p>
              <p
                id="user-display-username"
                class="text-[14px] font-medium text-indigo-400 mt-1"
              >
                @username
              </p>
            </div>
            <button
              onclick="handleLogout()"
              class="p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-600 hover:text-white transition duration-200 shadow-sm border border-red-100"
              title="Keluar"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                ></path>
              </svg>
            </button>
          </div>
        </div>
      </header>

      <main class="max-w-4xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
        <div class="bg-white p-6 shadow-xl rounded-lg">
          <div class="flex justify-between items-center mb-6 border-b pb-3">
            <h2 class="text-2xl font-semibold text-gray-800" id="form-subtitle">
              Formulir Report Shift
            </h2>
            <span
              id="edit-indicator"
              class="hidden bg-amber-100 text-amber-700 px-3 py-1 rounded-full text-xs font-bold border border-amber-200 uppercase tracking-widest"
              >Mode Edit</span
            >
          </div>

          <form id="laporan-form">
            <div
              class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 p-4 border rounded-lg bg-indigo-50/50"
            >
              <div>
                <label
                  for="input-staf"
                  class="block text-sm font-medium text-gray-700"
                  >Staf Pelaksana</label
                >
                <select
                  id="input-staf"
                  required
                  class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                ></select>
              </div>
              <div>
                <label
                  for="input-shift"
                  class="block text-sm font-medium text-gray-700"
                  >Pilih Shift</label
                >
                <select
                  id="input-shift"
                  required
                  class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                >
                  <option value="PAGI">PAGI</option>
                  <option value="SORE">SORE</option>
                  <option value="MALAM">MALAM</option>
                </select>
              </div>
              <div>
                <label
                  for="input-tanggal"
                  class="block text-sm font-medium text-gray-700"
                  >Tanggal</label
                >
                <input
                  type="date"
                  id="input-tanggal"
                  required
                  class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                />
              </div>
            </div>

            <div class="mb-8">
              <h3 class="text-xl font-medium text-indigo-700 mb-4">
                1. Menerima Tiket
              </h3>
              <div class="flex gap-2 mb-3">
                <button
                  type="button"
                  onclick="openMassEditModal()"
                  class="bg-pink-500 text-white px-3 py-1.5 rounded-md text-sm font-semibold hover:bg-pink-600 transition shadow-md flex items-center"
                >
                  <svg
                    class="w-4 h-4 mr-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
                    ></path>
                  </svg>
                  Ubah Massal
                </button>
              </div>
              <div id="transfer-in-container" class="space-y-3"></div>
              <button
                type="button"
                onclick="addTransferInRow()"
                class="mt-3 inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 shadow-sm transition"
              >
                <svg
                  class="w-5 h-5 mr-2 -ml-1"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 4v16m8-8H4"
                  ></path>
                </svg>
                Tambah Tiket Diterima
              </button>
            </div>

            <div class="mb-8">
              <h3 class="text-xl font-medium text-indigo-700 mb-4">
                2. Menangani Tiket
              </h3>
              <div id="handling-container" class="space-y-3"></div>
              <button
                type="button"
                onclick="addHandlingRow()"
                class="mt-3 inline-flex items-center px-4 py-2 text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 shadow-sm transition"
              >
                <svg
                  class="w-5 h-5 mr-2 -ml-1"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 4v16m8-8H4"
                  ></path>
                </svg>
                Tambah Tiket Ditangani
              </button>
            </div>

            <div
              id="quick-note-section"
              class="mt-12 mb-8 pt-8 border-t border-dashed border-gray-200"
            >
              <h3
                class="text-xl font-medium text-amber-700 mb-4 flex items-center"
              >
                <svg
                  class="w-6 h-6 mr-2"
                  fill="none"
                  stroke="currentColor"
                  viewBox="0 0 24 24"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                  ></path>
                </svg>
                Catatan Cepat
              </h3>

              <div
                class="bg-amber-50 p-4 rounded-lg mb-4 border border-amber-100 shadow-inner"
              >
                <div class="flex flex-col md:flex-row gap-3">
                  <input
                    type="text"
                    id="note-tiket-id"
                    placeholder="ID Tiket (Contoh: 12345)"
                    class="w-full md:w-1/4 p-2 border border-amber-200 rounded-md text-sm focus:ring-amber-500 focus:border-amber-500"
                  />
                  <input
                    type="text"
                    id="note-keterangan"
                    placeholder="Keterangan / Progress..."
                    class="flex-grow p-2 border border-amber-200 rounded-md text-sm focus:ring-amber-500 focus:border-amber-500"
                  />
                  <button
                    type="button"
                    onclick="saveQuickNote()"
                    class="bg-amber-600 text-white px-6 py-2 rounded-md hover:bg-amber-700 transition font-bold shadow-md"
                  >
                    Simpan
                  </button>
                </div>
              </div>

              <div
                class="overflow-x-auto bg-white rounded-lg border border-gray-200 shadow-sm"
              >
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th
                        class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-1/4"
                      >
                        ID Tiket
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider"
                      >
                        Keterangan
                      </th>
                      <th
                        class="px-6 py-3 text-left text-xs font-bold text-gray-500 uppercase tracking-wider w-24"
                      >
                        Waktu
                      </th>
                      <th
                        class="px-6 py-3 text-center text-xs font-bold text-gray-500 uppercase tracking-wider w-32"
                      >
                        Aksi
                      </th>
                    </tr>
                  </thead>
                  <tbody
                    id="notepad-body"
                    class="bg-white divide-y divide-gray-200 text-sm"
                  ></tbody>
                </table>
              </div>
            </div>

            <div class="mt-10 pt-4 border-t flex gap-4">
              <button
                type="submit"
                id="submit-btn"
                class="flex-grow bg-green-600 text-white p-3 rounded-md text-lg font-semibold hover:bg-green-700 transition"
              >
                Simpan Laporan Shift
              </button>
              <button
                type="button"
                onclick="window.location.href='index.html'"
                class="bg-gray-200 text-gray-700 p-3 rounded-md font-semibold hover:bg-gray-300 transition"
              >
                Batal
              </button>
            </div>
          </form>
        </div>
      </main>
    </div>

    <div
      id="massEditModal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50"
    >
      <div
        class="bg-white rounded-xl shadow-2xl w-full max-w-lg p-6 transform transition-all duration-300 scale-95 opacity-0"
        id="massEditModalContent"
      >
        <h3
          class="text-xl font-bold text-indigo-700 mb-4 border-b pb-2 flex justify-between items-center"
        >
          Aksi Massal Selektif
          <button
            onclick="closeMassEditModal()"
            class="text-gray-400 hover:text-gray-700"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </h3>
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >1. Kolom Filter:</label
            >
            <select
              id="filter-column"
              onchange="loadFilterValues()"
              class="w-full p-2 border border-gray-300 rounded-md"
            >
              <option value="none">Pilih Kolom...</option>
              <option value="dari_staf">Staf Pengirim</option>
              <option value="status_terima">Status Tiket</option>
            </select>
          </div>
          <div id="filter-value-container" class="hidden">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >2. Nilai yang dicari:</label
            >
            <select
              id="filter-value"
              class="w-full p-2 border border-gray-300 rounded-md"
              onchange="updateMassEditOptions()"
            ></select>
          </div>
          <div id="new-value-container" class="hidden">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >3. Aksi Baru:</label
            >
            <select
              id="new-value"
              class="w-full p-2 border border-gray-300 rounded-md"
            ></select>
          </div>
          <button
            onclick="applyMassEdit()"
            id="apply-mass-edit-btn"
            disabled
            class="w-full bg-green-500 text-white p-3 rounded-md font-semibold disabled:opacity-50"
          >
            Terapkan Perubahan
          </button>
        </div>
      </div>
    </div>

    <button
      onclick="toggleChatPanel()"
      class="fixed bottom-20 right-6 bg-green-500 text-white p-4 rounded-full shadow-2xl hover:bg-green-600 z-50 transition-all active:scale-95 md:bottom-10"
    >
      <svg
        class="w-6 h-6"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"
        ></path>
      </svg>
    </button>
    <div
      id="chat-discovery-indicator"
      class="hidden absolute z-[99] flex flex-col items-center justify-center pointer-events-none"
    >
      <div class="relative">
        <span
          class="animate-ping-slow absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"
        ></span>
        <span
          class="relative inline-flex rounded-full h-8 w-8 bg-green-500 flex items-center justify-center text-white font-bold text-xs"
        >
          ðŸ’¬
        </span>
      </div>
      <p
        class="mt-2 px-3 py-1 bg-white rounded-md shadow-lg text-xs font-semibold text-gray-700 whitespace-nowrap opacity-0 animate-fade-in-slow"
      >
        Template Chat Cepat!
      </p>
    </div>

    <div
      id="chat-overlay"
      onclick="toggleChatPanel()"
      class="fixed inset-0 bg-black/50 hidden z-[51] backdrop-blur-sm"
    ></div>

    <div
      id="chat-panel"
      class="fixed top-0 right-0 h-full w-80 bg-white shadow-2xl z-[52] transform translate-x-full transition-transform duration-300 ease-in-out md:w-96 flex flex-col"
    >
      <div
        class="p-4 bg-green-600 text-white flex justify-between items-center shrink-0"
      >
        <h3 class="font-bold flex items-center">
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M2 5a2 2 0 012-2h7a2 2 0 012 2v4a2 2 0 01-2 2H9l-3 3v-3H4a2 2 0 01-2-2V5z"
            ></path>
            <path
              d="M15 7v2a4 4 0 01-4 4H9.828l-1.766 1.767c.28.149.59.233.938.233h2l3 3v-3h2a2 2 0 002-2V9a2 2 0 00-2-2h-1z"
            ></path>
          </svg>
          Template Chat Cepat
        </h3>
        <button
          onclick="toggleChatPanel()"
          class="text-white hover:text-gray-200"
        >
          <svg
            class="w-6 h-6"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            ></path>
          </svg>
        </button>
      </div>

      <div
        class="flex border-b text-xs font-bold uppercase bg-gray-100 shrink-0"
      >
        <button
          onclick="switchChatTab('list')"
          id="tab-list"
          class="flex-1 py-3 text-green-600 border-b-2 border-green-600 bg-white"
        >
          Daftar
        </button>
        <button
          onclick="switchChatTab('admin')"
          id="tab-admin"
          class="flex-1 py-3 text-gray-500 hover:bg-gray-200"
        >
          Kelola
        </button>
      </div>

      <div
        id="chat-content-list"
        class="flex-grow overflow-y-auto p-4 space-y-4 bg-gray-50"
      >
        <div id="render-chat-list" class="space-y-4">
          <p class="text-xs text-center text-gray-400 mt-10 animate-pulse">
            Memuat template...
          </p>
        </div>
      </div>

      <div
        id="chat-content-admin"
        class="hidden flex-grow overflow-y-auto p-4 space-y-4 bg-white"
      >
        <input type="hidden" id="chat-id-edit" />
        <div class="space-y-3">
          <div>
            <label class="text-[10px] font-bold text-gray-500 uppercase"
              >Kategori</label
            >
            <select
              id="chat-kategori"
              class="w-full p-2 border rounded text-sm"
            >
              <option value="Pembayaran">Pembayaran</option>
              <option value="Konfirmasi">Konfirmasi</option>
              <option value="Pemberitahuan (Biasa)">
                Pemberitahuan (Biasa)
              </option>
              <option value="Pemberitahuan (Gamass)">
                Pemberitahuan (Gamass)
              </option>
            </select>
          </div>
          <div>
            <label class="text-[10px] font-bold text-gray-500 uppercase"
              >Isi Pesan</label
            >
            <textarea
              id="chat-pesan"
              rows="4"
              class="w-full p-2 border rounded text-sm"
              placeholder="Tulis pesan..."
            ></textarea>
          </div>
          <button
            onclick="saveChatTemplate()"
            id="btn-save-chat"
            class="w-full bg-green-600 text-white py-2 rounded font-bold text-sm"
          >
            Simpan
          </button>
          <button
            onclick="resetChatForm()"
            class="w-full py-2 text-gray-400 text-xs"
          >
            Batal / Reset
          </button>
        </div>
        <hr />
        <div id="render-chat-manage" class="space-y-2"></div>
      </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase_init.js"></script>
    <script src="js/input_logic.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // --- 1. SET OTOMATIS TANGGAL & SHIFT ---
        const inputTanggal = document.getElementById("input-tanggal");
        const inputShift = document.getElementById("input-shift");
        const today = new Date();
        const jam = today.getHours();

        if (inputTanggal) {
          inputTanggal.value = today.toISOString().split("T")[0];
        }

        if (inputShift) {
          if (jam >= 8 && jam < 16) inputShift.value = "PAGI";
          else if (jam >= 16 && jam < 23) inputShift.value = "SORE";
          else inputShift.value = "MALAM";
        }

        // --- 2. SIDEBAR & USER INFO ---
        const menuToggle = document.getElementById("menu-toggle");
        const sidebar = document.getElementById("sidebar");
        const backdrop = document.getElementById("backdrop");

        menuToggle?.addEventListener("click", () => {
          sidebar.classList.toggle("-translate-x-full");
          backdrop.classList.toggle("opacity-0");
          backdrop.classList.toggle("pointer-events-none");
          backdrop.classList.toggle("opacity-50");
        });

        backdrop?.addEventListener("click", () => {
          sidebar.classList.add("-translate-x-full");
          backdrop.classList.add("opacity-0", "pointer-events-none");
          backdrop.classList.remove("opacity-50");
        });

        const name = localStorage.getItem("userName");
        const username = localStorage.getItem("username");
        if (name)
          document.getElementById("user-display-name").textContent = name;
        if (username)
          document.getElementById(
            "user-display-username"
          ).textContent = `@${username.toLowerCase()}`;

        // --- 3. DROPDOWN STAF ---
        const inputStaf = document.getElementById("input-staf");
        const cachedStaff = JSON.parse(
          localStorage.getItem("staffCache") || "[]"
        );
        const role = (localStorage.getItem("userRole") || "user")
          .trim()
          .toLowerCase();
        const isAdmin = role === "admin" || role === "administrator";

        if (inputStaf && cachedStaff.length > 0) {
          inputStaf.innerHTML =
            '<option value="" disabled>Pilih Staf Pelaksana</option>';
          cachedStaff.forEach((staf) => {
            const opt = document.createElement("option");
            opt.value = staf.nama;
            opt.textContent = staf.nama.toUpperCase();
            inputStaf.appendChild(opt);
          });

          // Logika: User biasa terkunci di namanya sendiri, Admin bisa pilih siapa saja
          if (!isAdmin) {
            inputStaf.value = name;
            inputStaf.disabled = true;
          }
        }

        // --- 4. PROTEKSI ADMIN ELEMENT ---
        if (!isAdmin) {
          document
            .querySelectorAll(".admin-only")
            .forEach((el) => el.classList.add("hidden"));
        }
      });

      window.handleLogout = function () {
        Swal.fire({
          title: "Logout?",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#ef4444",
          confirmButtonText: "Ya, Logout",
        }).then((res) => {
          if (res.isConfirmed) {
            localStorage.clear();
            window.location.href = "login.html";
          }
        });
      };
    </script>
  </body>
</html>

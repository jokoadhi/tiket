<!DOCTYPE html>
<html lang="id">
  <head>
    <link rel="icon" type="image/png" href="assets/icons/ico.png" />
    <link rel="manifest" href="manifest.json" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="NOC Report" />
    <link rel="apple-touch-icon" href="assets/icons/ico.png" />
    <meta name="theme-color" content="#4f46e5" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Jadwal Staf NOC - Report App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      .content-area {
        transition: margin-left 0.3s ease-in-out;
        min-height: 100vh;
      }
      @media (min-width: 768px) {
        .content-area {
          margin-left: 16rem;
        }
      }
      /* Gaya khusus untuk tabel jadwal agar enak di-scroll */
      .table-container::-webkit-scrollbar {
        height: 8px;
      }
      .table-container::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 4px;
      }
      .sticky-col {
        position: sticky;
        left: 0;
        background-color: white;
        z-index: 10;
        border-right: 2px solid #e2e8f0;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <div
      id="backdrop"
      class="fixed inset-0 bg-black opacity-0 z-30 transition-opacity duration-300 md:hidden pointer-events-none"
    ></div>

    <nav
      class="bg-indigo-800 text-white w-64 space-y-6 py-7 px-2 fixed inset-y-0 left-0 transform -translate-x-full md:translate-x-0 transition duration-300 ease-in-out z-40 shadow-2xl"
      id="sidebar"
    >
      <a
        href="index.html"
        class="text-white flex items-center space-x-3 px-4 mb-8 border-b border-indigo-700 pb-4"
      >
        <svg
          class="w-7 h-7 text-indigo-300"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path d="M12 2L2 7V17L12 22L22 17V7L12 2Z"></path>
        </svg>
        <span class="text-2xl font-extrabold tracking-wider">Reporting</span>
      </a>
      <div class="px-4 space-y-1">
        <a
          href="index.html"
          class="flex items-center space-x-3 py-2 px-4 rounded-lg hover:bg-indigo-700 transition"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"
            ></path>
          </svg>
          <span>Dashboard</span>
        </a>
        <a
          href="input_tiket.html"
          class="flex items-center space-x-3 py-2 px-4 rounded-lg hover:bg-indigo-700 transition"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
            ></path>
          </svg>
          <span>Input Laporan</span>
        </a>
        <a
          href="jadwal.html"
          class="flex items-center space-x-3 py-2 px-4 rounded-lg bg-indigo-700 shadow-md font-semibold"
        >
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z"
              clip-rule="evenodd"
            ></path>
          </svg>
          <span>Jadwal Staf</span>
        </a>
        <a
          href="kelola_staf.html"
          class="admin-only flex items-center space-x-3 py-2 px-4 rounded-lg hover:bg-indigo-700 transition text-indigo-100"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20v-2c0-.214-.029-.426-.08-.632M20 10V8a2 2 0 00-2-2h-2m2 2h2m-2-2h-2m2 0v-2a2 2 0 00-2-2H4a2 2 0 00-2 2v10a2 2 0 002 2h2m-2-2h2m-2 0v-2a2 2 0 002-2h2m-2 2h2m-2 2h2m2-10a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"
            ></path>
          </svg>
          <span>Kelola Staf</span>
        </a>
        <a
          href="javascript:void(0)"
          onclick="cekAksesKelolaIP()"
          class="flex items-center space-x-3 py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-150 mt-1 text-indigo-100"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
            ></path>
          </svg>
          <span>Kelola IP</span>
        </a>
      </div>
    </nav>

    <div class="content-area">
      <header class="sticky top-0 bg-white shadow-md p-4 mb-4 z-30">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <button
              class="p-2 rounded-md hover:bg-gray-100 transition md:hidden"
              id="menu-toggle"
            >
              <svg
                class="w-6 h-6 text-indigo-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M4 6h16M4 12h16m-7 6h7"
                ></path>
              </svg>
            </button>
            <h1 class="text-xl md:text-2xl font-extrabold text-gray-800">
              Jadwal <span class="hidden md:inline">Shift Staf</span>
            </h1>
          </div>
          <div
            class="flex items-center space-x-3 border-l pl-4 border-gray-100"
          >
            <div class="text-right hidden sm:block">
              <p
                id="user-display-name"
                class="text-sm font-bold text-gray-800 leading-none capitalize"
              >
                Loading...
              </p>
              <p
                id="user-display-username"
                class="text-[14px] font-medium text-indigo-400 mt-1"
              >
                @username
              </p>
            </div>
            <button
              onclick="handleLogout()"
              class="p-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-600 hover:text-white transition duration-200 shadow-sm border border-red-100"
              title="Keluar"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
                ></path>
              </svg>
            </button>
          </div>
        </div>
      </header>

      <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pb-10">
        <div
          class="bg-white p-6 shadow-xl rounded-xl border border-gray-100 mb-8"
        >
          <div
            class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4"
          >
            <div class="w-full md:w-1/3">
              <label
                class="block text-sm font-black text-gray-700 mb-2 uppercase"
                >Periode Jadwal</label
              >
              <input
                type="month"
                id="pilih-bulan"
                onchange="loadDanRenderSemua()"
                class="w-full p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 font-bold text-gray-700 transition-all"
              />
            </div>
            <div class="admin-only flex flex-wrap gap-3 w-full md:w-auto">
              <button
                onclick="generatePolaOtomatis()"
                class="flex-1 md:flex-none bg-emerald-500 text-white font-black px-6 py-3 rounded-xl hover:bg-emerald-600 transition shadow-lg flex items-center justify-center gap-2"
              >
                <span>ü™Ñ Generate Pola</span>
              </button>
              <button
                onclick="resetJadwalLokal()"
                class="flex-1 md:flex-none bg-red-500 text-white font-black px-6 py-3 rounded-xl hover:bg-red-700 transition shadow-lg flex items-center justify-center gap-2"
              >
                <span>üóëÔ∏è Reset Jadwal</span>
              </button>
              <button
                onclick="simpanJadwal()"
                class="flex-1 md:flex-none bg-indigo-600 text-white font-black px-6 py-3 rounded-xl hover:bg-indigo-700 transition shadow-lg flex items-center justify-center gap-2"
              >
                <span>üíæ Simpan Semua</span>
              </button>
            </div>
          </div>
        </div>

        <div class="mb-10">
          <h3
            class="text-lg font-black text-indigo-800 mb-4 uppercase flex items-center bg-indigo-50 p-3 rounded-lg border-l-4 border-indigo-600"
          >
            üì° Tim NOC
          </h3>
          <div
            id="container-tabel-noc"
            class="table-container overflow-x-auto rounded-xl border border-gray-200 shadow-sm bg-white min-h-[100px]"
          ></div>
        </div>

        <div class="mb-10">
          <h3
            class="text-lg font-black text-orange-700 mb-4 uppercase flex items-center bg-orange-50 p-3 rounded-lg border-l-4 border-orange-500"
          >
            üõ†Ô∏è Tim Teknisi Lapangan
          </h3>
          <div
            id="container-tabel-teknisi"
            class="table-container overflow-x-auto rounded-xl border border-gray-200 shadow-sm bg-white min-h-[100px]"
          ></div>
        </div>
      </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="js/firebase_init.js"></script>
    <script src="js/jadwal_logic.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // 1. Sidebar Toggle Logic
        const menuToggle = document.getElementById("menu-toggle");
        const sidebar = document.getElementById("sidebar");
        const backdrop = document.getElementById("backdrop");
        function closeSidebar() {
          sidebar.classList.add("-translate-x-full");
          backdrop.classList.replace("opacity-50", "opacity-0");
          backdrop.classList.add("pointer-events-none");
        }
        function openSidebar() {
          sidebar.classList.remove("-translate-x-full");
          backdrop.classList.replace("opacity-0", "opacity-50");
          backdrop.classList.remove("pointer-events-none");
        }
        if (menuToggle) menuToggle.addEventListener("click", openSidebar);
        if (backdrop) backdrop.addEventListener("click", closeSidebar);

        // 2. User Info & Auth
        const name = localStorage.getItem("userName");
        const username = localStorage.getItem("username");
        const role = (localStorage.getItem("userRole") || "user")
          .trim()
          .toLowerCase();

        if (name && username) {
          document.getElementById("user-display-name").textContent = name;
          document.getElementById(
            "user-display-username"
          ).textContent = `@${username.toLowerCase()}`;
        } else {
          window.location.href = "login.html";
        }

        // 3. Admin Only Logic
        const isAdmin = role === "admin" || role === "administrator";
        if (!isAdmin) {
          document
            .querySelectorAll(".admin-only")
            .forEach((el) =>
              el.style.setProperty("display", "none", "important")
            );
        }

        // 4. Set Default Month to Today
        const filterBulan = document.getElementById("pilih-bulan");
        const now = new Date();
        filterBulan.value = `${now.getFullYear()}-${String(
          now.getMonth() + 1
        ).padStart(2, "0")}`;
        renderTable(); // Initial render
      });

      window.handleLogout = function () {
        Swal.fire({
          title: "Logout?",
          text: "Sesi Anda akan diakhiri.",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#ef4444",
          confirmButtonText: "Ya, Logout",
        }).then((result) => {
          if (result.isConfirmed) {
            localStorage.clear();
            window.location.href = "login.html";
          }
        });
      };
    </script>
  </body>
</html>
